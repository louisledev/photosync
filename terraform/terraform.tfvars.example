# Azure Photo Sync - Terraform Variables Example (Personal Accounts)
# Copy this file to terraform.tfvars and fill in your values
#
# Terraform automatically creates the Azure AD App Registration and client secret.
# You only need to provide refresh tokens after running `terraform apply` once.
#
# See docs/QUICKSTART.md for step-by-step instructions.

# ============================================================================
# Azure Subscription
# ============================================================================
subscription_id = "your-azure-subscription-id"  # ← Your Azure subscription ID

# ============================================================================
# Azure Infrastructure Settings
# ============================================================================
resource_group_name           = "photosync-rg"
function_app_name_prefix      = "photosync"
storage_account_name_prefix   = "photosync"
location                      = "westeurope"

# ============================================================================
# Azure Key Vault (Required for Personal Accounts)
# ============================================================================
enable_keyvault = true
key_vault_name  = "photosync-kv-UNIQUE"  # CHANGE THIS - must be globally unique!

# ============================================================================
# Source Account 1 (Your Personal Account)
# ============================================================================
# Note: ClientId is auto-generated by Terraform - do not specify it here
onedrive1_config = {
  "OneDrive1:SourceFolder"           = "/Photos"                   # ← Your photos folder
  "OneDrive1:RefreshTokenSecretName" = "source1-refresh-token"     # ← Key Vault secret name (DO NOT change)
  "OneDrive1:ClientSecretName"       = "source1-client-secret"     # ← Key Vault secret name (DO NOT change)
  "OneDrive1:DeleteAfterSync"        = "false"                     # ← Keep source files after sync
  "OneDrive1:MaxFilesPerRun"         = "100"                       # ← Max files per run (prevents timeout)
}

# ============================================================================
# Source Account 2 (Second Personal Account)
# ============================================================================
onedrive2_config = {
  "OneDrive2:SourceFolder"           = "/Pictures"                 # ← Second account's photos folder
  "OneDrive2:RefreshTokenSecretName" = "source2-refresh-token"     # ← Key Vault secret name (DO NOT change)
  "OneDrive2:ClientSecretName"       = "source2-client-secret"     # ← Key Vault secret name (DO NOT change)
  "OneDrive2:DeleteAfterSync"        = "false"                     # ← Keep source files after sync
  "OneDrive2:MaxFilesPerRun"         = "100"                       # ← Max files per run (prevents timeout)
}

# ============================================================================
# Destination Account (Shared Family Account)
# ============================================================================
onedrive_destination_config = {
  "OneDriveDestination:DestinationFolder"      = "/Synced Photos"              # ← Destination folder
  "OneDriveDestination:RefreshTokenSecretName" = "destination-refresh-token"   # ← Key Vault secret name (DO NOT change)
  "OneDriveDestination:ClientSecretName"       = "destination-client-secret"   # ← Key Vault secret name (DO NOT change)
}

# ============================================================================
# Refresh Tokens
# ============================================================================
# STEP 1: Run `terraform apply` first (creates App Registration)
#
# STEP 2: Get refresh tokens using the generated credentials:
#   node tools/get-refresh-token.js \
#     $(terraform -chdir=terraform output -raw onedrive_app_client_id) \
#     $(terraform -chdir=terraform output -raw onedrive_app_client_secret)
#
# STEP 3: Run the command 3 times (once per account):
#   - Sign in with each Microsoft account when browser opens
#   - Copy the refresh token from terminal output
#   - Paste it below
#
# STEP 4: Run `terraform apply` again to store tokens in Key Vault
#
# NOTE: Leave these empty for the first `terraform apply`, then fill them in.

source1_refresh_token     = ""  # ← Your account token (from step 2)
source2_refresh_token     = ""  # ← Second account token (from step 2)
destination_refresh_token = ""  # ← Destination account token (from step 2)

# ============================================================================
# What Terraform Creates Automatically
# ============================================================================
# - Azure AD App Registration with correct permissions
# - Client ID (output: onedrive_app_client_id)
# - Client Secret (output: onedrive_app_client_secret, stored in Key Vault)
# - Function Apps with managed identities
# - Key Vault with access policies
# - Application Insights for monitoring
#
# You do NOT need to create these manually!
